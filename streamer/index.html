<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #message {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Streamer Dashboard</h1>
    <p id="status">Connecting to server...</p>
    <button id="create-room-btn">Create Room</button>

    <h2>Room ID: <span id="room-id">N/A</span></h2>

    <h3>Stream Data:</h3>
    <textarea id="stream-data" rows="4" cols="50" disabled>Stream data will appear here...</textarea>

    <h3>Send a Comment:</h3>
    <input type="text" id="comment-input" placeholder="Enter comment" />
    <button id="send-comment-btn">Send Comment</button>

    <script>
        const socket = new WebSocket('ws://localhost:3000');
        const statusElement = document.getElementById('status');
        const createRoomButton = document.getElementById('create-room-btn');
        const roomIdElement = document.getElementById('room-id');
        const streamDataElement = document.getElementById('stream-data');
        const commentInput = document.getElementById('comment-input');
        const sendCommentButton = document.getElementById('send-comment-btn');

        let roomId = null;

        // Handle connection
        socket.onopen = () => {
            statusElement.textContent = 'Connected to server!';
        };

        // Handle incoming messages
        socket.onmessage = (message) => {
            const data = JSON.parse(message.data);

            if (data.type === 'room-created') {
                roomId = data.roomId;
                roomIdElement.textContent = roomId;
                statusElement.textContent = `Room created with ID: ${roomId}`;

                // Send stream data every 2 seconds
                setInterval(() => {
                    const streamData = {
                        type: 'stream-data',
                        roomId: roomId,
                        data: 'streaming-video-data-here'  // Simulating video stream
                    };
                    socket.send(JSON.stringify(streamData));
                    streamDataElement.textContent = 'Sending stream data...';
                }, 2000);
            }

            if (data.type === 'comment') {
                streamDataElement.textContent = `New Comment: ${data.message}`;
            }
        };

        // Handle errors
        socket.onerror = (error) => {
            console.error('WebSocket Error:', error);
            statusElement.textContent = 'Error connecting to the server';
        };

        // Handle close
        socket.onclose = () => {
            statusElement.textContent = 'Connection closed';
        };

        // Handle creating a room
        createRoomButton.onclick = () => {
            const createRoomMessage = JSON.stringify({ type: 'create-room' });
            socket.send(createRoomMessage);
        };

        // Handle sending comments
        sendCommentButton.onclick = () => {
            const comment = commentInput.value.trim();
            if (comment && roomId) {
                const commentMessage = {
                    type: 'comment',
                    roomId: roomId,
                    data: { message: comment }
                };
                socket.send(JSON.stringify(commentMessage));
                commentInput.value = ''; // Clear input after sending
            }
        };
    </script>

</body>
</html>
